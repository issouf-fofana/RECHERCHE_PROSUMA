{# apps/comparisons/templates/comparisons/summary_orders.html #}
{% extends "base.html" %}
{% load static %}
{% block title %}Synthèse commandes — Run #{{ run.id }}{% endblock %}

{% block content %}
<style>
  .report-wrap{max-width:1000px;margin:auto}
  .report-card{background:#fff;border:1px solid #e7ebf2;border-radius:14px;box-shadow:0 6px 18px rgba(20,35,70,.06)}
  .report-head{padding:14px 16px;border-bottom:1px solid #eef2f7;display:flex;justify-content:space-between;align-items:center}
  .report-head h5{margin:0;font-weight:800}
  .form-mini .form-select{border-radius:10px}
  .section{margin:18px 16px 22px}
  .bar{display:flex;justify-content:space-between;align-items:center;background:#072b5a;color:#fff;border-radius:6px;padding:10px 12px;font-weight:800;letter-spacing:.4px}
  .bar .right{text-transform:uppercase}
  .rows{border-left:3px solid #0c4a6e;border-right:3px solid #0c4a6e;border-bottom:3px solid #0c4a6e;border-radius:0 0 6px 6px}
  .row-item{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid #cde2f1}
  .row-item:last-child{border-bottom:none}
  .total{display:flex;justify-content:space-between;align-items:center;background:#ffc400;color:#0b1b3a;font-weight:800;border-radius:6px;padding:10px 12px;margin-top:8px}
  .legend{font-size:.85rem;color:#64748b}
</style>

<div class="report-wrap">
  <div class="report-card">
    <div class="report-head">
      <h5>Synthèse commandes — run #{{ run.id }}</h5>
      <div>
        <a class="btn btn-soft btn-sm" href="{% url 'comparisons:results' run.id %}">
          <i class="bi bi-arrow-left"></i> Retour aux écarts
        </a>
      </div>
    </div>

    <div class="p-3 form-mini">
      <form method="get" class="row g-2 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Colonne “Date commande”</label>
          <select name="date_cmd" class="form-select">
            <option value="">(Aucune)</option>
            {% for c in columns %}
              <option value="{{ c }}" {% if c == date_cmd_col %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Colonne “Magasin”</label>
          <select name="store" class="form-select">
            <option value="">(Aucune)</option>
            {% for c in columns %}
              <option value="{{ c }}" {% if c == store_col %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Colonne “Date livraison”</label>
          <select name="date_liv" class="form-select">
            <option value="">(Aucune)</option>
            {% for c in columns %}
              <option value="{{ c }}" {% if c == date_liv_col %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-12 d-flex gap-2">
          <button class="btn btn-primary"><i class="bi bi-funnel"></i> Appliquer</button>
          <a class="btn btn-outline-secondary" href="{% url 'comparisons:summary_orders' run.id %}">Réinitialiser</a>
        </div>
      </form>
    </div>

    <div class="p-3">
      {% if has_data %}
        {% for s in sections %}
          <div class="section">
            <div class="bar">
              <div>{{ s.title }}</div>
              <div class="right">{{ s.right }}</div>
            </div>
            <div class="rows">
              {% for label, count in s.rows %}
                <div class="row-item">
                  <div>{{ label }}</div>
                  <div><strong>{{ count }}</strong></div>
                </div>
              {% endfor %}
            </div>
            <div class="total">
              <div>Total général</div>
              <div>{{ s.total }}</div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-info mb-0">
          Choisis au moins une colonne (Date commande / Magasin / Date livraison) pour afficher la synthèse.
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
