{% load static %}
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Écarts{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

  <style>
    /* ===== Sidebar (bleu) ===== */
    .sidebar{
      background: linear-gradient(180deg,#0b3aa6 0%, #0a2f88 100%);
      color:#e6efff; min-height:100vh;
    }
    .sidebar hr{ border-color:rgba(255,255,255,.25); }

    /* ===== Marque / Logo plus grand ===== */
    .brand{display:flex;align-items:center;gap:12px;padding:0 12px}
    .brand .logo{
      position:relative; width:56px; height:56px;   /* ← plus grand */
      display:grid;place-items:center; overflow:hidden;
      border-radius:14px;
      background:linear-gradient(135deg,#0B1B46,#2563EB);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.18);
    }
    .brand .logo .logo-img{
      width:100%; height:100%; object-fit:contain; display:block;
      padding:6px; /* respiration autour du pictogramme */
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.25));
      background: transparent;
    }
    .brand .logo .logo-alt{
      position:absolute; inset:0; display:grid; place-items:center;
      font-weight:900; color:#fff; letter-spacing:.5px; font-size:1.15rem;
    }
    .brand .title{
      line-height:1.05; color:#fff; font-weight:800; font-size:1.25rem;
    }
    .brand a{ text-decoration:none; color:inherit }

    @media (max-width: 991.98px){
      .brand .logo{ width:48px; height:48px; border-radius:12px; }
      .brand .title{ font-size:1.15rem; }
    }

    /* ===== Liens de navigation ===== */
    .sidebar .nav .nav-link{
      color:#dbe7ff; padding:.55rem .75rem; border-radius:10px;
      transition: background-color .15s ease, transform .04s ease, color .15s ease, border-color .15s ease;
      border:1px solid transparent;
    }
    .sidebar .nav .nav-link:hover{ background:rgba(255,255,255,.12); color:#fff; }
    .sidebar .nav .nav-link:active{ transform: translateY(1px); }
    .sidebar .nav .nav-link.active{
      background:rgba(255,255,255,.16); color:#fff !important;
      border-color:rgba(255,255,255,.22); font-weight:700;
    }
    .sidebar .nav .nav-link:focus-visible{
      outline:2px solid rgba(255,255,255,.35); outline-offset:2px;
    }

    /* Bonjour / déconnexion */
    .sidebar .hello{ color:#cfe3ff; padding:0 12px; font-size:.9rem; }
    .sidebar .hello .name{ color:#fff; font-weight:700; }
    .sidebar .logout-btn{
      display:block; width:100%; text-align:left;
      padding:.55rem .75rem; border-radius:10px;
      background:transparent; border:0; color:#dbe7ff;
      transition: background-color .15s ease, transform .04s ease, color .15s ease;
    }
    .sidebar .logout-btn:hover{ background:rgba(255,255,255,.12); color:#fff; }
    .sidebar .logout-btn:active{ transform: translateY(1px); }
    .sidebar .logout-btn:focus-visible{
      outline:2px solid rgba(255,255,255,.35); outline-offset:2px;
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>
<body>

<div class="container-fluid">
  <div class="row">
    <!-- SIDEBAR -->
    <aside class="col-12 col-md-3 col-lg-2 sidebar py-4">
      <div class="brand mb-4">
        <a href="{% url 'ui:home' %}" class="d-flex align-items-center gap-2">
          <div class="logo">
            <!-- L’image cache le fallback “IF” si elle charge ; sinon “IF” reste visible -->
            <img
              src="{% static 'img/logo.png' %}"
              alt="IF"
              class="logo-img"
              onload="this.nextElementSibling.style.display='none';"
              onerror="this.style.display='none'">
            <span class="logo-alt">IF</span>
          </div>
          <div class="title">Comparateur d'écarts</div>
        </a>
      </div>

      <nav class="nav flex-column px-2">
        <a class="nav-link mb-1 {% if request.path == '/' %}active{% endif %}" href="{% url 'ui:home' %}">
          <i class="bi bi-speedometer2 me-2"></i> Dashboard
        </a>
        <a class="nav-link mb-1 {% if request.path|slice:':10' == '/datasets/' %}active{% endif %}" href="{% url 'datasets:upload' %}">
          <i class="bi bi-plus-square me-2"></i> Nouveau comparatif
        </a>
        <a class="nav-link mb-1 {% if request.path|slice:':14' == '/comparisons/' %}active{% endif %}" href="{% url 'comparisons:runs_dashboard' %}">
          <i class="bi bi-table me-2"></i> Mes comparatifs
        </a>

        {% if request.user.is_staff %}
          <a class="nav-link mb-1 {% if request.path|slice:':7' == '/admin/' %}active{% endif %}" href="/admin/">
            <i class="bi bi-shield-lock me-2"></i> Admin Django
          </a>
          {% url 'accounts:users_list' as users_list_url %}
          {% if users_list_url %}
            <a class="nav-link mb-1 {% if request.path|slice:':10' == '/accounts/' and 'users' in request.path %}active{% endif %}" href="{{ users_list_url }}">
              <i class="bi bi-people me-2"></i> Utilisateurs
            </a>
          {% endif %}
        {% endif %}

        <hr class="my-3">

        {% url 'accounts:profile' as profile_url %}
        {% url 'login' as login_url %}
        {% url 'logout' as logout_url %}

        {% if request.user.is_authenticated %}
          <div class="hello mb-2">
            <i class="bi bi-person-circle me-1"></i>
            Bonjour, <span class="name">{{ request.user.username }}</span>
          </div>

          <a class="nav-link mb-1 {% if request.path == profile_url %}active{% endif %}" href="{{ profile_url }}">
            <i class="bi bi-person-badge me-2"></i> Mon profil
          </a>

          <form method="post" action="{{ logout_url|default:'/' }}" class="px-2 mt-1">
            {% csrf_token %}
            <button type="submit" class="logout-btn">
              <i class="bi bi-box-arrow-right me-2"></i> Se déconnecter
            </button>
          </form>
        {% else %}
          <a class="nav-link mb-1" href="{{ login_url|default:'/' }}">
            <i class="bi bi-box-arrow-in-right me-2"></i> Se connecter
          </a>
        {% endif %}
      </nav>
    </aside>
    <!-- /SIDEBAR -->

    <!-- MAIN -->
    <main class="col-12 col-md-9 col-lg-10 py-4">
      {% if messages %}
        <div class="mb-3">
          {% for m in messages %}
            <div class="alert alert-{{ m.tags }} shadow-sm mb-2" role="alert">{{ m }}</div>
          {% endfor %}
        </div>
      {% endif %}
      {% block content %}{% endblock %}
    </main>
    <!-- /MAIN -->
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
{% block extra_js %}{% endblock %}
</body>
</html>
